<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Workout Journal</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 1em; max-width: 600px; margin: auto; }
    input, textarea, button, select { display: block; width: 100%; margin-bottom: 1em; padding: 0.5em; }
    #recentWorkoutBox { border: 1px solid #ccc; padding: 1em; background-color: #f9f9f9; }
    .hidden { display: none; }
  </style>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js"></script>
</head>
<body>
  <h1>Workout Journal</h1>
  <input type="date" id="workoutDate" />
  <input type="text" id="workoutName" placeholder="Workout Name (e.g., Chest)" />
  <textarea id="workoutDetails" rows="6" placeholder="Workout Details..."></textarea>
  <button onclick="saveWorkout()">Save Workout</button>
  <div id="recentWorkoutBox" class="hidden"></div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyC3Jon13meRVHu1-Wj7nGQbrevEi8LynbU",
      authDomain: "workoutjournal-c02f1.firebaseapp.com",
      projectId: "workoutjournal-c02f1",
      storageBucket: "workoutjournal-c02f1.firebasestorage.app",
      messagingSenderId: "554426612853",
      appId: "1:554426612853:web:4bc9958b0e3fc18c758c3c"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const workoutDate = document.getElementById('workoutDate');
    const workoutName = document.getElementById('workoutName');
    const workoutDetails = document.getElementById('workoutDetails');
    const recentWorkoutBox = document.getElementById('recentWorkoutBox');

    workoutDate.valueAsDate = new Date();

    workoutDate.addEventListener('change', loadWorkout);
    workoutName.addEventListener('input', showRecentWorkoutWithSameName);

    async function loadWorkout() {
      const date = workoutDate.value;
      if (!date) return;
      const doc = await db.collection('workouts').doc(date).get();

      if (doc.exists) {
        const data = doc.data();
        workoutName.value = data.name || '';
        workoutDetails.value = data.details || '';
      } else {
        workoutName.value = '';
        workoutDetails.value = '';
      }
      showRecentWorkoutWithSameName();
    }

    async function showRecentWorkoutWithSameName() {
      const name = workoutName.value.trim();
      if (!name) {
        recentWorkoutBox.classList.add('hidden');
        return;
      }

      const snapshot = await db.collection('workouts')
        .where('name', '==', name)
        .orderBy('timestamp', 'desc')
        .limit(1)
        .get();

      if (!snapshot.empty) {
        const data = snapshot.docs[0].data();
        recentWorkoutBox.textContent = data.details;
        recentWorkoutBox.classList.remove('hidden');
      } else {
        recentWorkoutBox.classList.add('hidden');
      }
    }

    async function saveWorkout() {
      const date = workoutDate.value;
      const name = workoutName.value.trim();
      const details = workoutDetails.value.trim();
      if (!date || !name || !details) return alert('Fill in all fields.');

      await db.collection('workouts').doc(date).set({
        name,
        details,
        timestamp: firebase.firestore.FieldValue.serverTimestamp()
      });

      alert('Workout saved!');
      showRecentWorkoutWithSameName();
    }

    loadWorkout();
  </script>
</body>
</html>
