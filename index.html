<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Workout Journal</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 1rem;
      background: #f4f4f4;
    }
    #login-section, #app-section {
      max-width: 600px;
      margin: auto;
    }
    textarea, input[type="text"], input[type="date"] {
      width: 100%;
      margin: 0.5rem 0;
      padding: 0.5rem;
    }
    .workout-entry {
      border: 1px solid #ccc;
      background: #fff;
      margin-top: 1rem;
      padding: 0.5rem;
    }
    .recent-container {
      display: flex;
      gap: 1rem;
    }
    .column {
      flex: 1;
    }
  </style>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
</head>
<body>
  <div id="login-section">
    <h2>Login</h2>
    <input type="text" id="username" placeholder="Enter your username">
    <button onclick="login()">Login</button>
  </div>

  <div id="app-section" style="display:none;">
    <h2>Workout Journal</h2>
    <input type="date" id="workout-date">
    <input type="text" id="workout-name" placeholder="Workout name (e.g., Chest)">
    <div class="recent-container">
      <div class="column">
        <textarea id="workout-details" placeholder="Workout details..."></textarea>
        <button onclick="saveWorkout()">Save Workout</button>
      </div>
      <div class="column">
        <div id="recent-workout"></div>
      </div>
    </div>

    <h3>Past 6 Workouts</h3>
    <div id="past-workouts"></div>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyC3Jon13meRVHu1-Wj7nGQbrevEi8LynbU",
      authDomain: "workoutjournal-c02f1.firebaseapp.com",
      projectId: "workoutjournal-c02f1",
      storageBucket: "workoutjournal-c02f1.firebasestorage.app",
      messagingSenderId: "554426612853",
      appId: "1:554426612853:web:4bc9958b0e3fc18c758c3c"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    let currentUser = null;

    function login() {
      const usernameInput = document.getElementById('username');
      const username = usernameInput.value.trim();
      if (!username) return;
      currentUser = username;
      localStorage.setItem('workoutUser', currentUser);
      document.getElementById('login-section').style.display = 'none';
      document.getElementById('app-section').style.display = 'block';
      loadPastWorkouts();
    }

    function saveWorkout() {
      const date = document.getElementById('workout-date').value;
      const details = document.getElementById('workout-details').value;
      const name = document.getElementById('workout-name').value.trim();
      if (!date || !details || !name || !currentUser) return;
      const docId = `${currentUser}_${date}`;
      db.collection('workouts').doc(docId).set({
        username: currentUser,
        date,
        name,
        details,
        timestamp: firebase.firestore.FieldValue.serverTimestamp()
      }).then(() => {
        loadPastWorkouts();
        loadRecentWorkoutByName(name);
      });
    }

    function loadWorkout(date) {
      const docId = `${currentUser}_${date}`;
      db.collection('workouts').doc(docId).get().then(doc => {
        if (doc.exists) {
          document.getElementById('workout-name').value = doc.data().name;
          document.getElementById('workout-details').value = doc.data().details;
          loadRecentWorkoutByName(doc.data().name);
        } else {
          document.getElementById('workout-details').value = '';
        }
      });
    }

    function loadPastWorkouts() {
      db.collection('workouts')
        .where('username', '==', currentUser)
        .orderBy('timestamp', 'desc')
        .limit(6)
        .get()
        .then(snapshot => {
          const container = document.getElementById('past-workouts');
          container.innerHTML = '';
          snapshot.forEach(doc => {
            const data = doc.data();
            const div = document.createElement('div');
            div.className = 'workout-entry';
            div.innerText = `${data.date}: ${data.name}\n${data.details}`;
            container.appendChild(div);
          });
        });
    }

    function loadRecentWorkoutByName(name) {
      db.collection('workouts')
        .where('username', '==', currentUser)
        .where('name', '==', name)
        .orderBy('timestamp', 'desc')
        .limit(1)
        .get()
        .then(snapshot => {
          const recentDiv = document.getElementById('recent-workout');
          recentDiv.innerHTML = '';
          if (!snapshot.empty) {
            const data = snapshot.docs[0].data();
            recentDiv.innerText = `${data.date}:\n${data.details}`;
          }
        });
    }

    document.getElementById('workout-date').addEventListener('change', (e) => {
      const date = e.target.value;
      if (date && currentUser) {
        loadWorkout(date);
      }
    });

    window.onload = () => {
      const savedUser = localStorage.getItem('workoutUser');
      if (savedUser) {
        currentUser = savedUser;
        document.getElementById('login-section').style.display = 'none';
        document.getElementById('app-section').style.display = 'block';
        loadPastWorkouts();
      }
    };
  </script>
</body>
</html>
